<!DOCTYPE html>
<html>
  <head>
    <title>Attendance</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />

    <script src="data.js"></script>
    <script src="html2pdf.bundle.min.js"></script>
  </head>
  <body>
    <div
      class="container"
      style="
        padding: 20px;
        min-height: 150px;
        height: 20vh;
        justify-content: space-between;
      "
    >
      <input type="date" name="" id="date" class="form-control" />
      <select
        name="courses"
        id="course"
        class="form-control"
        style="margin-top: 1%"
      >
        <option value="Database System">Database System</option>
        <option value="Theory of Automata">Theory of Automata</option>
        <option value="Operating System">Operating System</option>
        <option value="Differential Equation">Differential Equation</option>
        <option value="Quran Translation">Quran Translation</option>
      </select>
      <div class="container d-inline-flex justify-content-center style="padding-top: 2%">
        <button
          id="download-button"
          class="btn btn-outline-dark col-6"
          style="min-width: 200px"
          onclick="pdf()"
        >
          Download PDF
        </button>  
        <button

          id="download-button-csv"
          class="btn btn-outline-secondary col-6"
          style="min-width: 200px"
          
        >
          Download CSV
        </button>

      </div>
    </div>

<div class="container-fluid">
    <table class="table table-striped table-hover table-responsive " id="table">
        <thead class="thead-dark">
          <tr>
            <th scope="col" class="name">Registration Number</th>
            <th scope="col" class="name">Name</th>
            <th scope="col" class="name">Status</th>
            <th scope="col" onclick="statusClick()"></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>  
</div>
    <footer class="bg-dark text-center text-white">
        <!-- Copyright -->
        <div class="text-center p-3 " style="background-color: rgba(0, 0, 0, 0.2);">
          Â© 2022 Copyright:
          &#128513; Itna to banta ha bro &#x1F609;
        </div>
        <!-- Copyright -->
      </footer>
    <script type="text/javascript">



        document.getElementById("download-button-csv").addEventListener("click", function () {
          var html = document.querySelector("table").outerHTML;
          htmlToCSV(html, "Section-B-"+document.getElementById("date").value+".csv");
        });

      function htmlToCSV(html, filename) {
        var data = [];
        var rows = document.querySelectorAll("table tr");
        data.push(",,,,,,,Subject:," + document.getElementById("course").value);
        data.push(",,,,,,,Date:," + document.getElementById("date").value);
        for (var i = 0; i < rows.length; i++) {
          var row = [],
            cols = rows[i].querySelectorAll(".name");

          for (var j = 0; j < cols.length; j++) {
            row.push(cols[j].innerText);
          }
          data.push(row.join(","));
        }

        downloadCSVFile(data.join("\n"), filename);
      }

      function downloadCSVFile(csv, filename) {
        var csv_file, download_link;

        csv_file = new Blob([csv], { type: "text/csv" });

        download_link = document.createElement("a");

        download_link.download = filename;

        download_link.href = window.URL.createObjectURL(csv_file);

        download_link.style.display = "none";

        document.body.appendChild(download_link);

        download_link.click();
      }
      function generateTable() {
        
        let pCount = 0;
        let aCount = 0;
        for (let i = 0; i < response.length; i++) {
            if(response[i].Status ==="Present"){
                pCount++;
            }
            else{
                aCount++;
            }
        }
        let rowData =  "<center><h2>"+document.getElementById("course").value+"</h2></br><h2>"+document.getElementById("date").value+"</h2></center>"+"<div class=\"d-inline-flex flex-row justify-content-between\"><h5>Total Students: <em style=\"color:Blue;\">"+response.length+"</em></h5><h5 style=\"margin-left:25px\">Present Students: <em style=\"color:lightBlue;\">"+pCount+"</em></h5><h5 style=\"margin-left:25px\">Absent Students: <em style=\"color:red;\">"+aCount+"</em></h5></div>"+
                        "<table class=\"table table-striped table-hover table-responsive\" id=\"table\"> <thead class=\"thead-dark\"> <tr><th scope=\"col\" class=\"name\">Registration Number</th><th scope=\"col\" class=\"name\">Name</th> <th scope=\"col\" class=\"name\">Status</th></tr></thead><tbody>";
        for (let i = 0; i < response.length; i++) {
         if(response[i].Status ==="Present"){
            rowData +=
            '<tr><td class="name">' +
            response[i].RegistrationNumber +
            '</td><td class="name">' +
            response[i].Name +
            '</td><td  class="name" id="status' +
            i +
            '">' +
            response[i].Status +
            "</td></tr>";
         }
        }
        rowData += "</tbody></table>"
        console.log(rowData);
        return rowData;
      }
      run();
      function run() {
        let table = document.getElementById("table");

        let rowData = "";
        for (let i = 0; i < response.length; i++) {
          rowData +=
            '<tr><td class="name">' +
            response[i].RegistrationNumber +
            '</td><td class="name">' +
            response[i].Name +
            '</td><td  class="name" id="status' +
            i +
            '">' +
            response[i].Status +
            '</td><td><input type="checkbox" class="form-check-input rounded-circle bg-dark" id="present' +
            i +
            '" onchange="isStatusChecked(' +
            i +
            ')"/></td></tr>';
        }
        table.innerHTML += rowData;
      }
      function isStatusChecked(i) {

        console.log($("#present" + i + "").is(":checked"));
        if($("#present" + i + "").is(":checked")){
            
            response[i].Status = "Present";
        $("#status" + i + "").text("Present");
        }
        else{
            response[i].Status = "Absent";
        $("#status" + i + "").text("Absent");
         }
        
      }
      function statusClick() {
        for (let i = 0; i < response.length; i++) {
          response[i].Status = "Present";
          $("#status" + i + "").text("Present");
          $("#present" + i + "").prop("checked", true);
        }
      }
      function pdf() {
        const element = generateTable();
        html2pdf().from(element).save("Section-B-"+document.getElementById("date").value+".pdf");
      }
    </script>
    <script
      src="https://code.jquery.com/jquery-3.6.0.js"
      integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
      crossorigin="anonymous"
    ></script>
  </body>
</html>
